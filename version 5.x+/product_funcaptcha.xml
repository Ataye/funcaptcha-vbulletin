<?xml version="1.0" encoding="ISO-8859-1"?>

<product productid="funcaptcha" active="1">
	<title>FunCaptcha</title>
	<description>FunCaptcha stops spam with a fun, easy game.</description>
	<version>1.3.0.0</version>
	<url>http://www.funcaptcha.com/vb/</url>
	<versioncheckurl>http://funcaptcha.com/fc/plugins/vbulletin/versioncheck/</versioncheckurl>
	<dependencies>
		<dependency dependencytype="vbulletin" minversion="5.0" maxversion="" />
	</dependencies>
	<codes>
		<code version="1.3.0.0">
			<installcode><![CDATA[
				$vbulletin->db->query("
					UPDATE " . TABLE_PREFIX . "setting set optioncode = 'radio:piped
0|disabled
Image|image_verification
Question|question_verification
Recaptcha|recaptcha
FunCaptcha|FunCaptcha' where varname='hv_type'
		");

		$vbulletin->db->query("
		    UPDATE " . TABLE_PREFIX . "phrase set text = '<div>Choose the verification type that you wish to present to the user.</div>

			<div style=\"font-weight:bold; margin-top:1em\">Image Verification</div>
			<div>An image consisting of letters in varying fonts/shapes/sizes will be shown to the user. The appearance of this image is dictated by several options that you may control.</div>

			<div style=\"font-weight:bold; margin-top:1em\">Question and Answer Verification</div>
			<div>Questions provided by you that must be answered appropriately for verification.</div>

			<div style=\"font-weight:bold; margin-top:1em\"><a href=\"http://recaptcha.net\" target=\"_blank\">reCAPTCHA&trade;</a> Verification</div>
			<div>An image containing two words will be shown to the user. This verification supports audio, allowing blind users to register.</div>

			<div style=\"font-weight:bold; margin-top:1em\"><a href=\"http://www.funcaptcha.com\" target=\"_blank\">FunCaptcha</a></div>
			<div>FunCaptcha stops spam with a fun, easy game.</div>' where varname='setting_hv_type_desc'
		");

$vbulletin->db->query("UPDATE " . TABLE_PREFIX . "template set template = CONCAT(template, '
if (\$showHv){
	\$type=vB_Template_Runtime::parseData(\"hv\",\"fetchHvType\");
	if (\$type==\"FunCaptcha\"){
		\$data = vB_Template_Runtime::parseData(\"hvfuncaptcha\", \"fetchHvfuncaptcha\");
		\$final_rendered .= \"\".\$data ;
	}
}
			' ) where  title='humanverify'" );

]]></installcode>
			<uninstallcode><![CDATA[
				$vbulletin->db->query("UPDATE " . TABLE_PREFIX . "setting set value = '0' where varname='hv_type' and value='FunCaptcha'");

				$vbulletin->db->query("
		    UPDATE " . TABLE_PREFIX . "setting set optioncode = 'radio:piped
0|disabled
Image|image_verification
Question|question_verification
Recaptcha|recaptcha' where varname='hv_type'
		");
		$vbulletin->db->query("
		    UPDATE " . TABLE_PREFIX . "phrase set text = '<div>Choose the verification type that you wish to present to the user.</div>

			<div style=\"font-weight:bold; margin-top:1em\">Image Verification</div>
			<div>An image consisting of letters in varying fonts/shapes/sizes will be shown to the user. The appearance of this image is dictated by several options that you may control.</div>

			<div style=\"font-weight:bold; margin-top:1em\">Question and Answer Verification</div>
			<div>Questions provided by you that must be answered appropriately for verification.</div>

			<div style=\"font-weight:bold; margin-top:1em\"><a href=\"http://recaptcha.net\" target=\"_blank\">reCAPTCHA&trade;</a> Verification</div>
			<div>An image containing two words will be shown to the user. This verification supports audio, allowing blind users to register.</div>' where varname='setting_hv_type_desc'
		");

$res = $vbulletin->db->query_read("select template from " . TABLE_PREFIX . "template where title='humanverify' and template like '%funcaptcha%'");
				if ($vbulletin->db->num_rows($res)>0){
					$tmp = $vbulletin->db->fetch_array($res);
					$src = $tmp['template'];
					$toFind = 'if ($showHv){
	$type=vB_Template_Runtime::parseData("hv","fetchHvType");
	if ($type=="FunCAPTCHA"){
		$data = vB_Template_Runtime::parseData("hvfuncaptcha", "fetchHvfuncaptcha");
		$final_rendered .= "".$data ;
	}
}';
					$pattern = '/'.preg_replace('/\s+/','\s*',preg_quote($toFind,'/')).'/mi';
					$dst = preg_replace($pattern,"",$src,-1,$cnt); // 
					$vbulletin->db->query('UPDATE '. TABLE_PREFIX . "template set template = '".addslashes($dst)."' where title = 'humanverify' and template like '%funcaptcha%' ");
				}

]]></uninstallcode>
		</code>
	</codes>
	<templates>
	</templates>
	<stylevardfns>
	</stylevardfns>
	<stylevars>
	</stylevars>
	<hooks>
	</hooks>
	<phrases>
		<phrasetype name="Error Messages" fieldname="error">
			<phrase name="funcaptcha_unverfied" date="0" username="FunCaptcha" version="1.0"><![CDATA[Verification incomplete. Please solve the puzzle before you continue. The puzzle verifies that you are an actual user, not a spammer.]]></phrase>
		</phrasetype>
		<phrasetype name="GLOBAL" fieldname="global">
			<phrase name="funcaptcha_settings_page" date="1407823584" username="admin" version="1.2.1"><![CDATA[FunCaptcha Settings]]></phrase>
		</phrasetype>
		<phrasetype name="vBulletin Settings" fieldname="vbsettings">
			<phrase name="setting_funcaptcha_jsfallback_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[If the user does not have Javascript enabled, display a fallback CAPTCHA? (Most bots have Javascript disabled, we recommend you leave this disabled):]]></phrase>
			<phrase name="setting_funcaptcha_jsfallback_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[Javascript Fallback]]></phrase>
			<phrase name="setting_funcaptcha_newpost_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[Enter the number of posts until you want to show human verification to new user. Enter 0 if you want to disable this option]]></phrase>
			<phrase name="setting_funcaptcha_newpost_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[Number of posts]]></phrase>
			<phrase name="setting_funcaptcha_privatekey_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[Private Key (Register for this below):]]></phrase>
			<phrase name="setting_funcaptcha_privatekey_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Private Key]]></phrase>
			<phrase name="setting_funcaptcha_proxy_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[This field is optional - Proxy server (including port, eg: 111.11.11.111:8080):]]></phrase>
			<phrase name="setting_funcaptcha_proxy_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[Optional - Proxy Server]]></phrase>
			<phrase name="setting_funcaptcha_publickey_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[Public Key (Register for this below):]]></phrase>
			<phrase name="setting_funcaptcha_publickey_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Public Key]]></phrase>
			<phrase name="setting_funcaptcha_security_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[If you choose Automatic, security starts at the lowest level, and rises and falls automatically, adjusted by FunCaptcha's monitoring system. The Enhanced level has more challenges to solve, but is very hard for spammer programs to get past:]]></phrase>
			<phrase name="setting_funcaptcha_security_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Security Level]]></phrase>
			<phrase name="setting_funcaptcha_theme_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[This will change the appearance of FunCaptcha (see <a href="http://www.funcaptcha.com/themes/" target=\"_blank\">here</a> for what they look like):]]></phrase>
			<phrase name="setting_funcaptcha_theme_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Theme]]></phrase>
			<phrase name="setting_funcaptcha_label_desc" date="1407822637" username="admin" version="1.2.1"><![CDATA[The label that appears beside FunCaptcha, make it blank to hide it:]]></phrase>
			<phrase name="setting_funcaptcha_label_title" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Label]]></phrase>
			<phrase name="settinggroup_funcaptcha" date="1407822637" username="admin" version="1.2.1"><![CDATA[FunCaptcha Settings]]></phrase>
		</phrasetype>
	</phrases>
	<options>
		<settinggroup name="funcaptcha" displayorder="99">


			<setting varname="funcaptcha_security" displayorder="2">
				<datatype>free</datatype>
				<optioncode><![CDATA[<select name=\"setting[$setting[varname]]\" id=\"select_setting[funcaptcha_security]\" class=\"bginput\">
<option value=\"0\" " . iif($setting['value']=='0','selected="selected"') . ">Automatic</option>
<option value=\"20\" " . iif($setting['value']=='20','selected="selected"') . ">Always Enhanced</option>
</select>]]></optioncode>
				<defaultvalue>0</defaultvalue>
			</setting>
			<setting varname="funcaptcha_jsfallback" displayorder="4">
				<datatype>free</datatype>
				<optioncode><![CDATA[<select name=\"setting[$setting[varname]]\" id=\"select_setting[funcaptcha_jsfallback]\" class=\"bginput\">
<option value=\"0\" " . iif($setting['value']=='0','selected="selected"') . ">Disable</option>
<option value=\"1\" " . iif($setting['value']=='1','selected="selected"') . ">Enable</option>
</select>]]></optioncode>
				<defaultvalue>0</defaultvalue>
			</setting>
			<setting varname="funcaptcha_label" displayorder="5">
				<datatype>free</datatype>
				<defaultvalue>Verification:</defaultvalue>
			</setting>
			<setting varname="funcaptcha_publickey" displayorder="6">
				<datatype>free</datatype>
			</setting>
			<setting varname="funcaptcha_privatekey" displayorder="7">
				<datatype>free</datatype>
			</setting>
			<setting varname="funcaptcha_proxy" displayorder="8">
			</setting>
			<setting varname="funcaptcha_newpost" displayorder="9">
				<datatype>number</datatype>
				<defaultvalue>5</defaultvalue>
			</setting>
		</settinggroup>
	</options>
	<helptopics>
	</helptopics>
	<cronentries>
	</cronentries>
	<faqentries>
	</faqentries>
	<widgets>
	</widgets>
	<pagetemplates>
	</pagetemplates>
	<pages>
	</pages>
	<channels>
	</channels>
	<routes>
	</routes>
</product>
